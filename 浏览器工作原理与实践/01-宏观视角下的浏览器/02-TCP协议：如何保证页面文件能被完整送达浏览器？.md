1. FP (First Paint)
* 在衡量Web页面性能的时候 FP 是一个很重要的指标。是指从页面加载到首页开始绘制的时长。
* 影响 FP指标 其中一个重要的因素就是 网络加载速度 

* 本篇主要介绍在Web世界中的 TCP/IP是如何工作的
* 趣谈网络协议   Web协议详解与抓包实战

* 在网络中,一个文件通常被拆分为很多数据包来进行传输,而数据包在传输的过程中又很大概率丢失或者出错。

* 本篇文章站在数据包的视角 讲解如何保证页面文件能被完整地送达浏览器

# 一个数据包的 '旅程'
* 分别从 '数据包如何送达主机'  主机如何将数据包转交给应用   数据是如何被完整地送达应用程序 这三个角度来讲述数据的传输过程。

* 互联网,实际上是一套理念和协议组成的体系架构。
* 互联网中的数据是通过数据包来传输的。如果发送的数据很大,那么该数据就会被拆分为很多小数据包来传输。比如你现在听的音频数据,是拆分成一个个小的数据包来传输的,并不是一个大的文件一次传输过来的。

1. IP:把数据包送达目的主机
* 数据包要在互联网上进行传输,就要符合网际协议 ( Internet Protocol 简称 IP)标准。互联网上不同的在线设备都有唯一的地址,地址只是一个数字。
* `计算机的地址就称为 IP地址,访问任何网站实际上只是你的计算机向另外一台计算机请求信息`

![](https://raw.githubusercontent.com/1391020381/Front-end-Advancement/%E6%B5%8F%E8%A7%88%E5%99%A8%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86%E4%B8%8E%E5%AE%9E%E8%B7%B5/note/img/%E7%AE%80%E5%8C%96%E7%9A%84%20IP%20%E7%BD%91%E7%BB%9C%E4%B8%89%E5%B1%82%E4%BC%A0%E8%BE%93%E6%A8%A1%E5%9E%8B.png)

2. UDP:把数据包送达应用程序
* IP只负责把数据包传送到对方电脑,但是对方电脑并不知道把数据包交给哪个程序。所以需要基于IP之上开发能和应用大交道的协议,最常见的是 '用户数据包协议 ( User Datagram Protocol)' 简称 UDP
* UDP中一个最重要的信息时端口号, 端口号其实就是一个数字,每个想访问网络的程序都需要绑定一个端口号。通过端口号 UDP 就能指定的数据包发送给指定的程序了,`所以IP 通过IP地址信息把数据包大宋给指定的电脑,而UDP 通过端口号把数据包发送给正确的程序`

![](https://raw.githubusercontent.com/1391020381/Front-end-Advancement/%E6%B5%8F%E8%A7%88%E5%99%A8%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86%E4%B8%8E%E5%AE%9E%E8%B7%B5/note/img/%E7%AE%80%E5%8C%96%E7%9A%84%20UDP%20%E7%BD%91%E7%BB%9C%E5%9B%9B%E5%B1%82%E4%BC%A0%E8%BE%93%E6%A8%A1%E5%9E%8B.png)

* 在使用UDP发送数据时,有各种因素会导致数据包出错,虽然 UDP可以检验数据是否正确,但是对于错误的数据包,UDP并不提供重发机制,只是丢弃当前的包,而且UDP在发送之后也无法知道是否送达目的地。
*  虽说 `UDP不能保证数据可靠性,但是传输速却非常快。` 所以UDP 会应用在一些关注速度 但是不那么严格要求数据完整性的领域,如在线视频 互动游戏等。

1. TCP:把数据完整地送达应用程序。
  * 对于浏览器,或者邮件这类要求数据传输可靠性 (reliability)的应用,如果s使用UDP来传输会存在两个问题：
  1. 数据包在传输过程中容易丢失；
  2. 大文件会被拆分成很多小的数据包来传输，这些小的数据包会经过不同的路由，并在不同的时间到达接收端，而 UDP 协议并不知道如何组装这些数据包，从而把这些数据包还原成完整的文件。 

* TCP (Transmission Control Protocol 传输控制协议) 是一种面向连接的 可靠的 基于字节流的传输层通信协议。相对于 UDP TCP 有下面两个特点：
1. 对于数据丢包的情况, TCP 提供重传机制
2. TCP引入数据包排序机制,用来保证把 乱序的数据包组成一个完整的文件。

![](https://raw.githubusercontent.com/1391020381/Front-end-Advancement/%E6%B5%8F%E8%A7%88%E5%99%A8%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86%E4%B8%8E%E5%AE%9E%E8%B7%B5/note/img/%E7%AE%80%E5%8C%96%E7%9A%84%20TCP%20%E7%BD%91%E7%BB%9C%E5%9B%9B%E5%B1%82%E4%BC%A0%E8%BE%93%E6%A8%A1%E5%9E%8B.png)

1. 首先,建立连接阶段。这个阶段是通过 '三次握手' 来建立客户端和服务器之间的连接。TCP提供面向连接的通信传输。面向连接是指在数据通信开始之前先做好两端之间的准备工作。所谓三次握手,是指建立一个TCP连接时,客户端和服务器总共要发送三个数据包以确认连接的建立。
2. 其次,传输数据阶段。在该阶段,接受端需要对每个数据包进行确认操作,也就是接受端在接收到数据包之后,需要发送确认数据包给发送端。所以当发送端发送了一个数据包之后,在规定时间内没有接收到接收端反馈的确认消息,则判断为数据包丢失,并触发发送端的重发机制。同样,一个大的文件在传输过程中会被拆分成很多小的数据包,这些数据包到达接收端后,接收端会按照TCP头中序号为其排序,从而保证组成完整的数据。
3. 最后,断开连接阶段。数据传输完毕之后,就要终止连接了 涉及到最后一个阶段 '四次挥手' 来保证双方都能断开连接。


# 总结
* 互联网中的数据是通过数据包来传输的,数据包在传输过程中容易丢失或出错。
* IP负责把数据包送达目的机
* UDP负责把数据包送达具体应用
* 而TCP保证了数据完整地传输,它的连接分为三个阶段: 建立连接  传输数据  和断开连接。

![](https://raw.githubusercontent.com/1391020381/Front-end-Advancement/%E6%B5%8F%E8%A7%88%E5%99%A8%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86%E4%B8%8E%E5%AE%9E%E8%B7%B5/note/img/%E4%B8%80%E4%B8%AA%20TCP%20%E8%BF%9E%E6%8E%A5%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F.png)

1. 现在的浏览器可以同时打开多个页签,他们端口一样吗?如果一样,数据怎么知道去哪个页签?
* 端口一样的,网络进程知道每个tcp链接所对应的标签是那个,所以接受到数据后,会把数据分发给对应的渲染进程。

* websocket名字取的比较有迷惑性,其实和socket完全不一样,你可以吧websocket看成 httP的改造版,增加了服务器向客户端主动发送消息的能力

2. tcp 传送数据时 浏览器端就做渲染处理了么? 如果前面数据包丢了后面数据包先来是要等么？ 类似的那种实时渲染怎么处理？针对数据包的顺序性
* 接受到http响应头中的content-type类型时就开始准备渲染进程了
* 响应体数据一旦接受到便开始DOM解析了
* 基于http不用担心数据包丢失的问题,因为丢包和重传都是在tcp层解决的。 http能保证数据按照顺序接收的！

3. 关于 数据包在传输的过程中有可能会丢失或者出错 丢失的数据包去哪里了？凭空消失了吗？出错的数据包又变成啥了？ 为什么会出错？
*  比如网络波动  物理线路故障  设备故障  恶意程序拦截  网络阻塞等


4. `TCP / IP 建立连接和断开 连接要经历 三次握手 和四次挥手, 那么TCP 和HTTP建立连接和断开连接是不是也要经历这么一个过程？`